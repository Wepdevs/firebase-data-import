<!--<link rel="import" href="../polymer/polymer.html">-->
<link rel="import" href="../bower_components/polymerfire/polymerfire.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">


<!--
`firebase-data-import`
import data from a .json file to firebase

@demo demo/index.html 
-->

<dom-module id="firebase-data-import">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <firebase-app auth-domain="polymerfire-test.firebaseapp.com"
      database-url="https://polymerfire-test.firebaseio.com/"
      api-key="AIzaSyDTP-eiQezleFsV2WddFBAhF_WEzx_8v_g">
    </firebase-app>
    <firebase-auth id="auth" user="{{user}}" provider="google" on-error="handleError">
    </firebase-auth>

    <h2>Hello</h2>

    <iron-pages selected="{{selected}}" id="iron-pages-import">
      <div>
          <h2>1. Select Firebase DataBase</h2>
          <paper-input  id="DBConn" value="{{location}}"
          error-message="needs some text" required auto-validate>{{location}}</paper-input>  
      </div>
      <div>
          <h2>2. Databse Authentication</h2>
          <paper-input label="Email"  id="user" value="{{user}}"
          error-message="needs some text" required auto-validate></paper-input>
          <paper-input label="Password"  id="password" value="{{password}}"
          error-message="needs some text" required auto-validate></paper-input>
          <!--<paper-input label="login error" id="loginError"></paper-input>-->
          <paper-input-container id="loginError">
          <!--<label>Login error</label>-->
          <input is="iron-input">
          </paper-input-container>
          
          
      </div>
      <div>
          <h2>3. Select JSON file to upload into database</h2>
          <paper-input type="file" label="file" id="file"></paper-input>
    </div>
    <div>
       <h2>4. Select in which branch of Firebase to upload</h2>
           <paper-dropdown-menu label="Branches">
              <paper-menu class="dropdown-content" id="branchesMenu" selected="{{chosenBranch}}" attr-for-selected="name">
                    <template is="dom-repeat" items="{{branches}}" as="branch">
                        <paper-item name="[[branch.name]]">[[branch.name]]</paper-item>
                    </template>
                </paper-menu>
        </paper-dropdown-menu>
       </div>
       <div>
          <h2>5. Result</h2>
          <div>Import completed!</div>
      </div>  
    </iron-pages>
    <paper-button on-tap="prevPage" disabled$="{{_computeHiddenPrev(selected)}}">PREV</paper-button>
    <paper-button on-tap="nextPage" disabled$="{{_computeHiddenNext(selected)}}">NEXT</paper-button>




  </template>

  <script>
    Polymer({

      is: 'firebase-data-import',

      properties: {
            authDomanin:{type:String},
            databaseUrl:{type:String},  
            apiKey:{type:String},
            user:{type:Object},
            selected: {type: Number,value: 0},
        },

      nextPage: function(){
            var pages = document.querySelector('#iron-pages-import');
            var errorText = document.querySelector('#loginError input');

            switch(this.selected){
                case 0: 
                    if(this.$.DBConn.validate())
                    this.ref = new Firebase(this.location);
                        pages.selectNext();
                    break;
                case 1:
                    if(this.$.user.validate() && this.$.password.validate()){
                        this.ref.authWithPassword({
                        email    : this.user,
                        password : this.password
                        }, function(error, authData) {
                            if (error) {
                                switch (error.code) {
                                case "INVALID_EMAIL":
                                    //console.log("The specified user account email is invalid.");
                                    errorText.value = "The specified user account email is invalid.";
                                    break;
                                case "INVALID_PASSWORD":
                                    //console.log("The specified user account password is incorrect.");
                                    errorText.value = "The specified user account password is incorrect."
                                    break;
                                case "INVALID_USER":
                                    //console.log("The specified user account does not exist.");
                                    errorText.value = "The specified user account does not exist."
                                    break;
                                default:
                                    //console.log("Error logging user in:", error);
                                    loginError = "Error logging user in";
                                }
                            } else {
                                console.log("Authenticated successfully!");
                                pages.selectNext();
                            }
                        });
                        
                        this.$.file.addEventListener('change', this.saveFile);
                        
                        this.getBranches(this.ref);
                    } 
                    break;
                case 2:
                    if(this.validateFile()){
                        pages.selectNext();
                    }   
                    else{
                        alert('Upload a file!');
                    }
                    break;
                case 3:
                    this.importData();
                    pages.selectNext();
                    break;
                    default:
                        pages.selectNext();
            }
        },
        
        prevPage: function(){
            var pages = document.querySelector('#iron-pages-import');
            alert('asd');
            switch(this.selected){
                case 0: 
                    break;
                default:
                    pages.selectPrevious();
            }   
        },

        _computeHiddenNext: function(){
            return this.selected == 4;
        },
        _computeHiddenPrev: function(){
            return this.selected == 0;
        }
    });
  </script>
</dom-module>




<!--<script src="https://www.gstatic.com/firebasejs/3.3.0/firebase.js"></script>
<script>
  // Initialize Firebase
  // TODO: Replace with your project's customized code snippet
  var config = {
    apiKey: "<API_KEY>",
    authDomain: "<PROJECT_ID>.firebaseapp.com",
    databaseURL: "https://<DATABASE_NAME>.firebaseio.com",
    storageBucket: "<BUCKET>.appspot.com",
  };
  firebase.initializeApp(config);
</script>-->
